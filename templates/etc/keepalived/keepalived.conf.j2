vrrp_script check_proxy {
  script "killall -0 haproxy && killall -0 nutcracker"  # check haproxy process
  interval 3  # check every 3 seconds
  timeout 3  # seconds after which script is considered to have failed
  fall 2  # require 2 failures for KO
  rise 2  # require 2 succeses for OK
}

vrrp_instance VI_51 {
  state BACKUP
  interface {{ keepalived_interface }}
  virtual_router_id 51
  priority {{ (inventory_hostname == groups['controller'][0])|ternary(100, 90) }}
  advert_int 1
  nopreempt
  virtual_ipaddress {
    {{ keepalived_vip }}
  }
   track_script {
    check_proxy
  }
}
