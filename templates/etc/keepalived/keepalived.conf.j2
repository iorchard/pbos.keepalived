vrrp_script check_memcached {
  script "/usr/bin/nc -w1 -z {{ ansible_host }} {{ _memcached_port }}" # memcached listening ip port
  interval 3  # check every 3 seconds
  timeout 1  # seconds after which script is considered to have failed
  fall 3  # require 3 failures for KO
  rise 3  # require 3 succeses for OK
}

vrrp_instance VI_51 {
  state BACKUP
  interface {{ keepalived_interface }}
  virtual_router_id 51
  priority {{ (inventory_hostname == groups['controller'][0])|ternary(100, 50) }}
  advert_int 1
  nopreempt
  virtual_ipaddress {
    {{ keepalived_vip }}
  }
   track_script {
    check_memcached
  }
}
